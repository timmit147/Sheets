<!DOCTYPE html>
<html>
<head>
  <title>Fetch Google Sheets as JSON</title>
</head>
<body>
  <div id="data-container"></div>

  <script>
    function handleResponse(response) {
      var jsonData = {};

      var sheets = response.sheets;
      for (var i = 0; i < sheets.length; i++) {
        var sheetData = sheets[i].data[0].rowData;
        var sheetName = sheets[i].properties.title;

        var sheetObj = {};
        for (var j = 0; j < sheetData.length; j++) {
          var rowData = sheetData[j].values;
          if (rowData && rowData.length >= 3) {
            var fieldA = rowData[0] ? rowData[0].formattedValue : '';
            var fieldB = rowData[1] ? rowData[1].formattedValue : '';
            var fieldC = rowData[2] ? rowData[2].formattedValue : '';

            if (fieldA) {
              if (!sheetObj[fieldA]) {
                sheetObj[fieldA] = {};
              }
              if (fieldB) {
                if (!sheetObj[fieldA][fieldB]) {
                  sheetObj[fieldA][fieldB] = [];
                }
                if (fieldC) {
                  sheetObj[fieldA][fieldB].push(fieldC);
                }
              }
            }
          }
        }

        if (Object.keys(sheetObj).length > 0) {
          if (!jsonData[sheetName.toLowerCase()]) {
            jsonData[sheetName.toLowerCase()] = {};
          }
          jsonData[sheetName.toLowerCase()] = mergeObjects(jsonData[sheetName.toLowerCase()], sheetObj);
        }
      }

      // Display the JSON data on the page
      var jsonContainer = document.getElementById('data-container');
      jsonContainer.textContent = JSON.stringify(jsonData, null, 2);
    }

    function fetchSheetAsJSON() {
      var apiKey = 'AIzaSyCNb3QEXaLYWUI3gVY-LOn0jKj1kcpT_e0';
      var spreadsheetId = '1XTPqQhuETtk8WFFS6IN2q9HRmQPdyFQe5pF5fs1zji4';

      var sheetUrl = `https://sheets.googleapis.com/v4/spreadsheets/${spreadsheetId}?includeGridData=true&key=${apiKey}`;

      fetch(sheetUrl)
        .then(function(response) {
          if (!response.ok) {
            throw new Error('Failed to fetch Google Sheets data');
          }
          return response.json();
        })
        .then(function(data) {
          handleResponse(data);
        })
        .catch(function(error) {
          var errorMessage = 'Error fetching Google Sheets data: ' + error.message;
          var errorContainer = document.getElementById('data-container');
          errorContainer.textContent = errorMessage;
        });
    }

    function mergeObjects(obj1, obj2) {
      for (var key in obj2) {
        if (obj2.hasOwnProperty(key)) {
          if (obj1[key]) {
            obj1[key] = Array.isArray(obj1[key])
              ? obj1[key].concat(obj2[key])
              : [obj1[key], obj2[key]];
          } else {
            obj1[key] = obj2[key];
          }
        }
      }
      return obj1;
    }

    // Fetch the Google Sheets data as JSON for all sheets on page load
    fetchSheetAsJSON();
  </script>
</body>
</html>
